<section>
  <d-button bsStyle="primary" (click)="onAddBusinessDoc()">New</d-button>
  <ng-container *ngIf="JSON.stringify(businessDocs) !== '[]'; else noBusinessDoc">
    <ng-template [ngTemplateOutlet]="showBusinessDoc"></ng-template>
  </ng-container>
</section>

<ng-template #noBusinessDoc>
  <h3 dLoading [loading]="loading">No Document</h3>
</ng-template>

<ng-template #showBusinessDoc>
  <div
    dAnchorBox
    class="my-main"
    style="position: relative"
    [defaultAnchor]="'doc-0'"
  >
    <div class="my-sidebar">
      <d-sticky>
        <ul class="step-nav">
          <li
            *ngFor="let businessDoc of businessDocs;index as i"
            [dAnchorLink]="'doc-'+i"
            anchorActive="active"
          >
            <section>
              <div *ngIf="!businessDoc['$name']">
                <d-icon
                  [icon]="'icon-edit'"
                  dIconHover
                  [operable]="true"
                  (click)="onNameEdit(businessDoc)">
                  <span iconPrefix>{{ businessDoc.name }}</span>
                </d-icon>
              </div>
              <div *ngIf="businessDoc['$name']">
                <input dTextInput [(ngModel)]="businessDoc.name" (keyup)="onUpdateBusinessDoc(businessDoc)" />
              </div>
            </section>
          </li>
        </ul>
      </d-sticky>
    </div>
    <div class="my-content">
      <div
        *ngFor="let businessDoc of businessDocs;index as i"
        [dAnchor]="'doc-'+i"
        class="section-block"
      >
        <section>
          <h1 class="devui-h3-title" style="display: inline-block">{{ businessDoc.name }}</h1>
          <section style="float: right; padding: 3px 0">
            <d-button
              *ngIf="businessDoc['$content']"
              style="margin-right: 5px"
              bsStyle="text"
              type="submit"
              (btnClick)="onUpdateBusinessDoc(businessDoc)">
              <strong>Save</strong>
            </d-button>
            <d-button
              *ngIf="!businessDoc['$content']"
              style="margin-right: 5px"
              bsStyle="text"
              type="submit"
              (btnClick)="onContentEdit(businessDoc)">
              <strong>Edit</strong>
            </d-button>
            <d-button
              bsStyle="text"
              type="submit"
              (btnClick)="onDeleteBusinessDoc(businessDoc)">
              <strong>Delete</strong>
            </d-button>
          </section>
        </section>
        <section>
          <span>Created by {{ businessDoc.author }}</span>
          <span *ngIf="businessDoc.lastEditor "> last modified by {{ businessDoc.lastEditor }}</span>
        </section>
        <section>
          <div *ngIf="businessDoc['$content']">
            <app-ace-editor
              [maxLines]="30"
              [aceValue]="businessDoc.content"
              (onChange)="onContentChange($event,businessDoc)"
            >
            </app-ace-editor>
          </div>
          <div *ngIf="!businessDoc['$content']">
            <markdown lineHighlight [data]="businessDoc.content"></markdown>
          </div>
        </section>
        <div style="height: 5px"></div>
      </div>
    </div>
  </div>
</ng-template>
